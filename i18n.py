LANG_FILE = "lang.json"

DEFAULT_LANG = "zh_CN"

# Embedded translations to avoid missing file issues
TRANSLATIONS = {
    "zh_CN": {
        "app_title": "VitalityGuard - 防沉迷助手",
        "settings_title": "VitalityGuard 配置",
        "current_mode": "当前模式:",
        "save_restart": "保存设置",
        "work_duration": "工作时长 (分钟):",
        "rest_duration": "休息时长 (分钟):",
        "countdown": "倒计时 (秒, 0为关闭):",
        "allow_black_screen_unlock": "允许黑屏时解锁（按钮点击或ESC按键5次）",
        "auto_start": "开机自启动",
        "auto_start_failed": "设置开机自启动失败: {error}",
        "auto_update": "自动更新 (静默下载，下次启动生效)",
        "night_sleep_enabled": "启用夜间强制休眠（在此时间段无法开机）",
        "start_time": "开始时间 (HH:MM):",
        "end_time": "结束时间 (HH:MM):",
        "new_mode_title": "新建模式",
        "new_mode_prompt": "请输入新模式名称 (英文ID):",
        "error_mode_exists": "该模式名称已存在",
        "error_create_failed": "创建失败",
        "confirm_delete": "确定要删除模式 '{mode}' 吗?",
        "error_delete_last": "至少保留一个模式",
        "success_saved": "配置已保存，助手正在后台运行",
        "error_invalid_input": "输入无效，请输入数字",
        "tray_tooltip": "VitalityGuard (防沉迷助手)",
        "tray_menu_settings": "打开设置",
        "tray_menu_quit": "退出",
        "notification_title": "VitalityGuard",
        "notification_started": "防沉迷助手已启动，将在后台运行。",
        "countdown_text": "即将进入休息\n{time}",
        "countdown_subtext": "为了您的健康，请休息一下",
        "countdown_skip": "紧急跳过 (Skip)",
        "countdown_noskip": "(此模式下不可跳过)",
        "rest_screen_title": "休息时间",
        "rest_screen_text": "休息时间\n{time}",
        "emergency_unlock": "紧急解锁 (Emergency Unlock)",
        "curfew_text": "夜间休息\n好好休息",
        "curfew_shutdown_hint": "当前处于夜间休息时间，系统将被强制休眠。\n无法在此时间段使用电脑。\n休眠期间您的文件将保持原样，请勿担心。",
        "lock_cancelled": "用户取消了锁定。",
        "language": "语言 / Language:",
        "mode_default": "默认模式",
        "mode_meeting": "会议模式",
        "mode_movie": "观影模式",
        "press_esc_hint": "连按 5 次 ESC 解锁"
    },
    "en_US": {
        "app_title": "VitalityGuard - Anti-Overwork Assistant",
        "settings_title": "VitalityGuard Settings",
        "current_mode": "Current Mode:",
        "save_restart": "Save Settings",
        "work_duration": "Work Duration (min):",
        "rest_duration": "Rest Duration (min):",
        "countdown": "Countdown (sec, 0=off):",
        "allow_black_screen_unlock": "Allow unlock during black screen (button or ESC x5)",
        "auto_start": "Start on Boot",
        "auto_start_failed": "Failed to set startup: {error}",
        "auto_update": "Auto Update Check",
        "night_sleep_enabled": "Enable Night Forced Hibernation (Cannot power on)",
        "start_time": "Start Time (HH:MM):",
        "end_time": "End Time (HH:MM):",
        "new_mode_title": "New Mode",
        "new_mode_prompt": "Enter new mode name (English ID):",
        "error_mode_exists": "Mode name already exists",
        "error_create_failed": "Creation failed",
        "confirm_delete": "Delete mode '{mode}'?",
        "error_delete_last": "Keep at least one mode",
        "success_saved": "Settings saved. Running in background.",
        "error_invalid_input": "Invalid input. Numbers only.",
        "tray_tooltip": "VitalityGuard",
        "tray_menu_settings": "Settings",
        "tray_menu_quit": "Quit",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuard started in background.",
        "countdown_text": "Rest Starting in\n{time}",
        "countdown_subtext": "Take a break for your health",
        "countdown_skip": "Skip",
        "countdown_noskip": "(Cannot skip in this mode)",
        "rest_screen_title": "Rest Time",
        "rest_screen_text": "Rest Time\n{time}",
        "emergency_unlock": "Emergency Unlock",
        "curfew_text": "Night Rest\nSleep Well",
        "curfew_shutdown_hint": "Night Rest active. System forcing hibernation.\nCannot use computer during this time.\nYour files will remain safe during hibernation.",
        "lock_cancelled": "Lock cancelled by user.",
        "language": "Language:",
        "mode_default": "Default",
        "mode_meeting": "Meeting",
        "mode_movie": "Movie",
        "press_esc_hint": "Press ESC 5 times to unlock"
    },
    "ja_JP": {
        "app_title": "VitalityGuard - 過労防止アシスタント",
        "settings_title": "VitalityGuard 設定",
        "current_mode": "現在のモード:",
        "save_restart": "設定を保存",
        "work_duration": "作業時間 (分):",
        "rest_duration": "休憩時間 (分):",
        "countdown": "カウントダウン (秒, 0=オフ):",
        "allow_black_screen_unlock": "黒画面中の解除を許可（ボタン / ESC 5回）",
        "auto_start": "Windows 起動時に自動起動",
        "auto_start_failed": "自動起動の設定に失敗しました: {error}",
        "auto_update": "自動更新 (Auto Update)",
        "night_sleep_enabled": "夜間強制休止を有効化 (起動不可)",
        "start_time": "開始時間 (HH:MM):",
        "end_time": "終了時間 (HH:MM):",
        "new_mode_title": "新規モード",
        "new_mode_prompt": "新規モード名を入力 (英語ID):",
        "error_mode_exists": "そのモード名は既に存在します",
        "error_create_failed": "作成に失敗しました",
        "confirm_delete": "モード '{mode}' を削除しますか?",
        "error_delete_last": "少なくとも1つのモードを保持してください",
        "success_saved": "設定が保存されました。バックグラウンドで実行中。",
        "error_invalid_input": "無効な入力です。数字を入力してください。",
        "tray_tooltip": "VitalityGuard (過労防止アシスタント)",
        "tray_menu_settings": "設定を開く",
        "tray_menu_quit": "終了",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuardが起動しました。バックグラウンドで実行中です。",
        "countdown_text": "まもなく休憩です\n{time}",
        "countdown_subtext": "健康のために休憩しましょう",
        "countdown_skip": "スキップ (Skip)",
        "countdown_noskip": "(このモードではスキップできません)",
        "rest_screen_title": "休憩時間",
        "rest_screen_text": "休憩時間\n{time}",
        "emergency_unlock": "緊急解除 (Emergency Unlock)",
        "curfew_text": "夜間休憩\nおやすみなさい",
        "curfew_shutdown_hint": "夜間休憩時間です。システムを強制休止します。\nこの時間帯はPCを使用できません。\n休止中、ファイルはそのまま保持されますのでご安心ください。",
        "lock_cancelled": "ユーザーによってロックがキャンセルされました。",
        "language": "言語 / Language:",
        "mode_default": "デフォルト",
        "mode_meeting": "会議",
        "mode_movie": "映画",
        "press_esc_hint": "ESCキーを5回押して解除"
    },
    "ko_KR": {
        "app_title": "VitalityGuard - 과로 방지 도우미",
        "settings_title": "VitalityGuard 설정",
        "current_mode": "현재 모드:",
        "save_restart": "설정 저장",
        "work_duration": "작업 시간 (분):",
        "rest_duration": "휴식 시간 (분):",
        "countdown": "카운트다운 (초, 0=끄기):",
        "allow_black_screen_unlock": "블랙 스크린 중 해제 허용(버튼 또는 ESC 5회)",
        "auto_start": "Windows 시작 시 자동 실행",
        "auto_start_failed": "자동 실행 설정 실패: {error}",
        "auto_update": "자동 업데이트 (Auto Update)",
        "night_sleep_enabled": "야간 강제 최대절전 사용(해당 시간대 사용 불가)",
        "start_time": "시작 시간 (HH:MM):",
        "end_time": "종료 시간 (HH:MM):",
        "new_mode_title": "새 모드",
        "new_mode_prompt": "새 모드 이름 입력(영문 ID):",
        "error_mode_exists": "이미 존재하는 모드 이름입니다",
        "error_create_failed": "생성 실패",
        "confirm_delete": "모드 '{mode}'을(를) 삭제할까요?",
        "error_delete_last": "최소 1개의 모드를 유지해야 합니다",
        "success_saved": "설정이 저장되었습니다. 백그라운드에서 실행 중입니다.",
        "error_invalid_input": "잘못된 입력입니다. 숫자만 입력하세요.",
        "tray_tooltip": "VitalityGuard",
        "tray_menu_settings": "설정 열기",
        "tray_menu_quit": "종료",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuard가 백그라운드에서 실행 중입니다.",
        "countdown_text": "곧 휴식 시작\n{time}",
        "countdown_subtext": "건강을 위해 잠시 쉬어 주세요",
        "countdown_skip": "건너뛰기",
        "countdown_noskip": "(이 모드에서는 건너뛸 수 없습니다)",
        "rest_screen_title": "휴식 시간",
        "rest_screen_text": "휴식 시간\n{time}",
        "emergency_unlock": "긴급 해제",
        "curfew_text": "야간 휴식\n푹 쉬세요",
        "curfew_shutdown_hint": "야간 휴식 시간입니다. 시스템이 강제로 최대절전됩니다.\n이 시간대에는 PC를 사용할 수 없습니다.\n최대절전 중 파일은 그대로 유지됩니다.",
        "lock_cancelled": "사용자가 잠금을 취소했습니다.",
        "language": "언어 / Language:",
        "mode_default": "기본",
        "mode_meeting": "회의",
        "mode_movie": "영화",
        "press_esc_hint": "ESC를 5번 눌러 해제"
    },
    "fr_FR": {
        "app_title": "VitalityGuard - Assistant anti-surmenage",
        "settings_title": "Paramètres VitalityGuard",
        "current_mode": "Mode actuel :",
        "save_restart": "Enregistrer",
        "work_duration": "Durée de travail (min) :",
        "rest_duration": "Durée de repos (min) :",
        "countdown": "Compte à rebours (s, 0=off) :",
        "allow_black_screen_unlock": "Autoriser le déverrouillage pendant l'écran noir (bouton ou ESC x5)",
        "auto_start": "Démarrer avec Windows",
        "auto_start_failed": "Échec du démarrage auto : {error}",
        "auto_update": "Mise à jour auto (Auto Update)",
        "night_sleep_enabled": "Activer l'hibernation forcée la nuit (PC inutilisable)",
        "start_time": "Heure de début (HH:MM) :",
        "end_time": "Heure de fin (HH:MM) :",
        "new_mode_title": "Nouveau mode",
        "new_mode_prompt": "Nom du mode (ID anglais) :",
        "error_mode_exists": "Ce mode existe déjà",
        "error_create_failed": "Création échouée",
        "confirm_delete": "Supprimer le mode '{mode}' ?",
        "error_delete_last": "Conserver au moins un mode",
        "success_saved": "Paramètres enregistrés. Exécution en arrière-plan.",
        "error_invalid_input": "Entrée invalide. Nombres uniquement.",
        "tray_tooltip": "VitalityGuard",
        "tray_menu_settings": "Paramètres",
        "tray_menu_quit": "Quitter",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuard est lancé en arrière-plan.",
        "countdown_text": "Début de la pause dans\n{time}",
        "countdown_subtext": "Faites une pause pour votre santé",
        "countdown_skip": "Ignorer",
        "countdown_noskip": "(Impossible d'ignorer dans ce mode)",
        "rest_screen_title": "Temps de pause",
        "rest_screen_text": "Temps de pause\n{time}",
        "emergency_unlock": "Déverrouillage d'urgence",
        "curfew_text": "Repos nocturne\nDormez bien",
        "curfew_shutdown_hint": "Repos nocturne actif. Hibernation forcée.\nPC inutilisable durant cette période.\nVos fichiers resteront intacts.",
        "lock_cancelled": "Verrouillage annulé par l'utilisateur.",
        "language": "Langue / Language:",
        "mode_default": "Défaut",
        "mode_meeting": "Réunion",
        "mode_movie": "Film",
        "press_esc_hint": "Appuyez sur ESC 5 fois pour déverrouiller"
    },
    "de_DE": {
        "app_title": "VitalityGuard - Anti-Überlastung Assistent",
        "settings_title": "VitalityGuard Einstellungen",
        "current_mode": "Aktueller Modus:",
        "save_restart": "Speichern & neu starten",
        "work_duration": "Arbeitsdauer (Min):",
        "rest_duration": "Schwarzbild-Dauer (Min):",
        "countdown": "Countdown (Sek, 0=aus):",
        "allow_black_screen_unlock": "Entsperren während Schwarzbild erlauben (Button oder ESC x5)",
        "auto_start": "Mit Windows starten",
        "auto_start_failed": "Autostart fehlgeschlagen: {error}",
        "auto_update": "Automatische Aktualisierung (Auto Update)",
        "night_sleep_enabled": "Nächtliche Zwangs-Hibernation aktivieren (nicht nutzbar)",
        "start_time": "Startzeit (HH:MM):",
        "end_time": "Endzeit (HH:MM):",
        "new_mode_title": "Neuer Modus",
        "new_mode_prompt": "Modusname (engl. ID):",
        "error_mode_exists": "Modus existiert bereits",
        "error_create_failed": "Erstellung fehlgeschlagen",
        "confirm_delete": "Modus '{mode}' löschen?",
        "error_delete_last": "Mindestens einen Modus behalten",
        "success_saved": "Einstellungen gespeichert. Läuft im Hintergrund.",
        "error_invalid_input": "Ungültige Eingabe. Nur Zahlen.",
        "tray_tooltip": "VitalityGuard",
        "tray_menu_settings": "Einstellungen",
        "tray_menu_quit": "Beenden",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuard läuft im Hintergrund.",
        "countdown_text": "Pause startet in\n{time}",
        "countdown_subtext": "Mach eine Pause für deine Gesundheit",
        "countdown_skip": "Überspringen",
        "countdown_noskip": "(In diesem Modus nicht möglich)",
        "rest_screen_title": "Pausenzeit",
        "rest_screen_text": "Pausenzeit\n{time}",
        "emergency_unlock": "Not-Entsperren",
        "curfew_text": "Nachtruhe\nSchlaf gut",
        "curfew_shutdown_hint": "Nachtruhe aktiv. System wird in den Ruhezustand versetzt.\nPC ist in dieser Zeit nicht nutzbar.\nDateien bleiben erhalten.",
        "lock_cancelled": "Sperre vom Benutzer abgebrochen.",
        "language": "Sprache / Language:",
        "mode_default": "Standard",
        "mode_meeting": "Meeting",
        "mode_movie": "Film",
        "press_esc_hint": "ESC 5-mal drücken zum Entsperren"
    },
    "es_ES": {
        "app_title": "VitalityGuard - Asistente anti-sobrecarga",
        "settings_title": "Ajustes de VitalityGuard",
        "current_mode": "Modo actual:",
        "save_restart": "Guardar ajustes",
        "work_duration": "Duración trabajo (min):",
        "rest_duration": "Duración descanso (min):",
        "countdown": "Cuenta atrás (s, 0=off):",
        "allow_black_screen_unlock": "Permitir desbloqueo en pantalla negra (botón y ESC x5)",
        "auto_start": "Iniciar con Windows",
        "auto_start_failed": "Error al configurar inicio: {error}",
        "night_sleep_enabled": "Activar hibernación forzada nocturna (no usable)",
        "start_time": "Hora inicio (HH:MM):",
        "end_time": "Hora fin (HH:MM):",
        "new_mode_title": "Nuevo modo",
        "new_mode_prompt": "Nombre del modo (ID en inglés):",
        "error_mode_exists": "El modo ya existe",
        "error_create_failed": "Error al crear",
        "confirm_delete": "¿Eliminar el modo '{mode}'?",
        "error_delete_last": "Conserva al menos un modo",
        "success_saved": "Ajustes guardados. Ejecutándose en segundo plano.",
        "error_invalid_input": "Entrada inválida. Solo números.",
        "tray_tooltip": "VitalityGuard",
        "tray_menu_settings": "Ajustes",
        "tray_menu_quit": "Salir",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuard está ejecutándose en segundo plano.",
        "countdown_text": "Descanso en\n{time}",
        "countdown_subtext": "Tómate un descanso por tu salud",
        "countdown_skip": "Saltar",
        "countdown_noskip": "(No se puede saltar en este modo)",
        "rest_screen_title": "Tiempo de descanso",
        "rest_screen_text": "Tiempo de descanso\n{time}",
        "emergency_unlock": "Desbloqueo de emergencia",
        "curfew_text": "Descanso nocturno\nDuerme bien",
        "curfew_shutdown_hint": "Descanso nocturno activo. Hibernación forzada.\nNo se puede usar el PC en este periodo.\nTus archivos permanecerán intactos.",
        "lock_cancelled": "Bloqueo cancelado por el usuario.",
        "language": "Idioma / Language:",
        "mode_default": "Predeterminado",
        "mode_meeting": "Reunión",
        "mode_movie": "Película",
        "press_esc_hint": "Pulsa ESC 5 veces para desbloquear"
    },
    "ru_RU": {
        "app_title": "VitalityGuard — помощник против переработок",
        "settings_title": "Настройки VitalityGuard",
        "current_mode": "Текущий режим:",
        "save_restart": "Сохранить и перезапустить",
        "work_duration": "Работа (мин):",
        "rest_duration": "Чёрный экран (мин):",
        "countdown": "Обратный отсчёт (сек, 0=выкл):",
        "allow_black_screen_unlock": "Разрешить разблокировку во время чёрного экрана (кнопка или ESC x5)",
        "auto_start": "Запускать с Windows",
        "auto_start_failed": "Не удалось включить автозапуск: {error}",
        "auto_update": "Автообновление (Auto Update)",
        "night_sleep_enabled": "Ночная принудительная гибернация (в это время нельзя пользоваться ПК)",
        "start_time": "Время начала (HH:MM):",
        "end_time": "Время окончания (HH:MM):",
        "new_mode_title": "Новый режим",
        "new_mode_prompt": "Имя режима (англ. ID):",
        "error_mode_exists": "Такой режим уже существует",
        "error_create_failed": "Не удалось создать",
        "confirm_delete": "Удалить режим '{mode}'?",
        "error_delete_last": "Нужно оставить хотя бы один режим",
        "success_saved": "Настройки сохранены. Работа в фоне.",
        "error_invalid_input": "Неверный ввод. Только числа.",
        "tray_tooltip": "VitalityGuard",
        "tray_menu_settings": "Настройки",
        "tray_menu_quit": "Выход",
        "notification_title": "VitalityGuard",
        "notification_started": "VitalityGuard запущен и работает в фоне.",
        "countdown_text": "Отдых начнётся через\n{time}",
        "countdown_subtext": "Сделайте перерыв ради здоровья",
        "countdown_skip": "Пропустить",
        "countdown_noskip": "(В этом режиме нельзя пропустить)",
        "rest_screen_title": "Время отдыха",
        "rest_screen_text": "Время отдыха\n{time}",
        "emergency_unlock": "Аварийная разблокировка",
        "curfew_text": "Ночной отдых\nСпокойной ночи",
        "curfew_shutdown_hint": "Идёт ночной отдых. Система принудительно уходит в гибернацию.\nВ это время ПК недоступен.\nФайлы сохранятся.",
        "lock_cancelled": "Блокировка отменена пользователем.",
        "language": "Язык / Language:",
        "mode_default": "По умолчанию",
        "mode_meeting": "Встреча",
        "mode_movie": "Фильм",
        "press_esc_hint": "Нажмите ESC 5 раз для разблокировки"
    }
}

class I18n:
    _instance = None

    def __new__(cls):
        if cls._instance is None:
            cls._instance = super(I18n, cls).__new__(cls)
            cls._instance.lang = DEFAULT_LANG
            cls._instance.load_lang()
        return cls._instance

    def load_lang(self):
        # Detect system language if not set? 
        # For now simple variable.
        pass

    def set_lang(self, lang_code):
        if lang_code in TRANSLATIONS:
            self.lang = lang_code
            return True
        return False

    def get(self, key, **kwargs):
        text = TRANSLATIONS.get(self.lang, TRANSLATIONS[DEFAULT_LANG]).get(key, key)
        if kwargs:
            try:
                return text.format(**kwargs)
            except:
                return text
        return text

i18n = I18n()
